name: Tests

vars:
  base_url: http://localhost:8080
  base_timeout: 5

testcases:
  - name: PING
    steps:
      - type: http
        method: GET
        url: "{{.base_url}}/api/ping"
        timeout: "{{.base_timeout}}"
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson ShouldEqual "ok"
#TENDERS
#OK
  - name: TENDERS RETURN ARRAY
    steps:
      - type: http
        method: GET
        url: "{{.base_url}}/api/tenders"
        timeout: "{{.base_timeout}}"
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson ShouldBeArray
  - name: TENDERS RETURN ARRAY WITH LIMIT
    steps:
      - type: http
        method: GET
        url: "{{.base_url}}/api/tenders?limit=1"
        timeout: "{{.base_timeout}}"
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson ShouldBeArray
          - result.bodyjson ShouldNotBeNil
          - or:
            - result.bodyjson ShouldHaveLength 0
            - result.bodyjson ShouldHaveLength 1
  - name: TENDERS RETURN ARRAY WITH OFFSET
    steps:
      - type: http
        method: GET
        url: "{{.base_url}}/api/tenders?offset=1"
        timeout: "{{.base_timeout}}"
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson ShouldBeArray
  - name: TENDERS RETURN ARRAY WITH TYPE
    steps:
      - type: http
        method: GET
        url: "{{.base_url}}/api/tenders?service_type=Delivery"
        timeout: "{{.base_timeout}}"
        assertions:
          - result.statuscode ShouldEqual 200
          - result.bodyjson ShouldBeArray
#BAD REQUESTS
  - name: TENDERS LIMIT BAD REQUEST
    steps:
      - type: http
        method: GET
        url: "{{.base_url}}/api/tenders?limit=-1"
        timeout: "{{.base_timeout}}"
        assertions:
          - result.statuscode ShouldEqual 400
  - name: TENDERS OFFSET BAD REQUEST
    steps:
      - type: http
        method: GET
        url: "{{.base_url}}/api/tenders?offset=-1"
        timeout: "{{.base_timeout}}"
        assertions:
          - result.statuscode ShouldEqual 400
  - name: TENDERS SERVICE TYPE BAD REQUEST
    steps:
      - type: http
        method: GET
        url: "{{.base_url}}/api/tenders?service_type=bad"
        timeout: "{{.base_timeout}}"
        assertions:
          - result.statuscode ShouldEqual 400